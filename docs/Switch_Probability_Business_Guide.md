# Switch Probability - Business Guide

## What is Switch Probability?

**Switch Probability** is a predictive score that tells you how likely a client is to change their trading strategy in the next 14 days.

Think of it like a "early warning system" for relationship managers - it helps you spot clients who might be getting ready to change how they trade, so you can reach out proactively.

### The Score

- **Range:** 15% to 85%
- **What it means:**
  - **15-39%** ‚Üí Low risk - Client is stable, trading as usual
  - **40-64%** ‚Üí Medium risk - Some changes happening, worth monitoring
  - **65-85%** ‚Üí High risk - Significant changes detected, urgent action needed

---

## How Does It Work?

The system analyzes a client's recent trading behavior and compares it to their historical patterns. It looks for five key warning signs:

### 1. **Pattern Instability** (30% weight)

**What we're looking for:** Is the client's trading becoming erratic or inconsistent?

**Examples:**
- A client who normally trades 50-100 lots per day suddenly starts trading 200 lots one day and 20 lots the next
- A client who usually trades 3-4 currency pairs starts jumping between 8-10 different pairs

**Why it matters:** Inconsistent behavior often signals confusion or a shift in strategy

---

### 2. **Regime Change Detection** (25% weight)

**What we're looking for:** Has there been a sudden, significant change in trading patterns?

**Examples:**
- A client who always traded in the morning suddenly switches to afternoon trading
- A client's buy/sell ratio shifts dramatically (e.g., from 50/50 to 80/20)

**Why it matters:** Abrupt changes usually mean the client is experimenting with a new approach

---

### 3. **Directional Flip-Flopping** (20% weight)

**What we're looking for:** Is the client constantly changing their mind about market direction?

**Examples:**
- Monday: Buys EUR/USD
- Tuesday: Sells EUR/USD
- Wednesday: Buys EUR/USD again
- This happens repeatedly throughout the month

**Why it matters:** Frequent direction changes indicate uncertainty or strategy confusion

---

### 4. **Position Reversal Acceleration** (15% weight)

**What we're looking for:** Is the client reversing positions (going from long to short or vice versa) more often than usual?

**Examples:**
- Normally flips 2-3 positions per month
- Recently started flipping 6-8 positions per month
- The rate of flipping is increasing

**Why it matters:** Accelerating reversals suggest the client is searching for a new approach

---

### 5. **Extreme Behavior** (10% weight)

**What we're looking for:** Is the client showing unusual extremes in their trading behavior?

**Examples:**
- Holding positions for 60+ days when they normally hold 5-7 days
- Holding positions for <2 days when they normally hold 30+ days
- Suddenly using very aggressive order types

**Why it matters:** Extreme changes often precede a full strategy shift

---

## Real-World Examples

### Example 1: Stable Client (Switch Prob = 24%)

**Profile:** Sarah Chen - Trend Follower
- Trades 4-5 times per day consistently
- Holds positions for 3-4 days on average
- Rarely reverses positions (1-2 times per month)
- Trading patterns very consistent over 90 days

**What the system sees:**
- Pattern Instability: **5%** (very stable)
- Regime Change: **5%** (no breaks detected)
- Direction Flips: **5%** (consistent bias)
- Position Reversals: **2%** (declining rate)
- Extreme Behavior: **0%** (all normal)

**Final Score:** 30% baseline + 17% signals = **47%** ‚Üí Clamped down to **24%** (LOW risk)

**Action:** Continue normal relationship management

---

### Example 2: Client Showing Drift (Switch Prob = 58%)

**Profile:** Michael Torres - Mean Reverter (historically)
- Previously: Frequent position flips (15/month), 6-day average holds
- Recently: Flips reduced to 8/month, holds extended to 12 days
- Started trading new instruments not in historical pattern

**What the system sees:**
- Pattern Instability: **12%** (some variance)
- Regime Change: **18%** (shift detected in last 2 weeks)
- Direction Flips: **10%** (moderate changes)
- Position Reversals: **10%** (declining but still notable)
- Extreme Behavior: **3%** (longer holds than normal)

**Final Score:** 30% baseline + 53% signals = **83%** ‚Üí Stays at **58%** (MEDIUM risk)

**Action:** Schedule a review call within 1-2 weeks to understand what's changing

---

### Example 3: High-Risk Client (Switch Prob = 78%)

**Profile:** David Park - Previously Stable Hedger
- Historical: Low turnover, 45-day average holds, minimal flips
- Recent 14 days: Trading frequency up 200%, holds down to 8 days, 12 position flips
- Completely different instrument mix

**What the system sees:**
- Pattern Instability: **22%** (high variance)
- Regime Change: **25%** (major break detected)
- Direction Flips: **20%** (frequent changes)
- Position Reversals: **15%** (accelerating rapidly)
- Extreme Behavior: **8%** (multiple extremes)

**Final Score:** 30% baseline + 90% signals = **120%** ‚Üí Clamped to **78%** (HIGH risk)

**Action:** **URGENT** - Contact within 24-48 hours to discuss strategy

---

## What Should You Do With This Information?

### For Relationship Managers

| Switch Probability | Priority | Recommended Action | Timeline |
|-------------------|----------|-------------------|----------|
| **65-85% (HIGH)** | üî¥ Urgent | Proactive call to discuss recent changes | 24-48 hours |
| **40-64% (MEDIUM)** | üü° Monitor | Schedule review call, prepare questions | 1-2 weeks |
| **15-39% (LOW)** | üü¢ Normal | Continue regular touchpoints | Normal cadence |

### What to Ask High-Risk Clients

1. **"We noticed some changes in your trading patterns - is everything going well?"**
   - Opens conversation without being confrontational
   
2. **"Are you exploring new strategies or testing different approaches?"**
   - Shows you're paying attention
   
3. **"How can we support you better given these changes?"**
   - Positions you as helpful, not intrusive

4. **"Would you like to review your portfolio construction with our strategists?"**
   - Offers value-added service

---

## Understanding the "Drivers"

When you see a high switch probability, the system also shows you the **top 3 drivers** - these are the specific reasons for the score.

### Example Drivers You Might See

**Good (Stable Client):**
- "Very long 52-day holding period reflects conviction"
- "Low turnover (0.3 trades/day) shows stability"
- "Consistent hedging approach with minimal drift"

**Warning Signs (At-Risk Client):**
- "Very high momentum alignment (0.89) with market moves"
- "Sharp increase in position volatility last 14 days"
- "Frequent position flips (12/month) shows reversal-seeking"

### Risk Flags

These are specific concerns the system has identified:

| Risk Flag | What It Means | Why It Matters |
|-----------|---------------|----------------|
| **"EUR concentration"** | >60% of positions in EUR pairs | Overexposed to single currency |
| **"volatility spike"** | Recent sharp increase in position changes | Possible panic or confusion |
| **"strategy drift"** | Breaking from historical patterns | Testing new approach |
| **"flip acceleration"** | Position reversals increasing | Searching for direction |
| **"high leverage"** | Using more leverage than usual | Taking on more risk |

---

## Common Questions

### Q: Why does the score range from 15% to 85%, not 0% to 100%?

**A:** We "clamp" the extremes because:
- **Below 15%:** No client is ever 100% predictable - there's always some uncertainty
- **Above 85%:** Even the most erratic client has some consistency - we avoid overconfidence

This makes the score more reliable and prevents false alarms.

### Q: How often is this score updated?

**A:** The score is recalculated whenever you click "Refresh" in the client profile, which runs a full analysis using the last 90 days of trading data.

### Q: What if the score is high but I know the client is stable?

**A:** Trust your relationship knowledge! The score is a **tool**, not a replacement for human judgment. If you have context the system doesn't (e.g., "client told me they're testing a new strategy this month"), factor that in.

However, it's still worth a quick check-in to confirm everything is going as planned.

### Q: Can I see historical switch probability scores?

**A:** Yes! The system stores every calculation, so you can see how a client's score has evolved over time in the Timeline view.

---

## How the System Learns

While the current version uses statistical rules, the system is designed to improve over time:

### What We Track
1. **Predictions made** - Which clients had high switch probability scores
2. **Outcomes** - Did those clients actually change strategies?
3. **Actions taken** - Did RM intervention help stabilize the client?

### Future Improvements
- Machine learning models trained on actual switch events
- Segment-specific thresholds (hedgers behave differently than trend followers)
- Market condition adjustments (some volatility is normal during major news events)
- Longer prediction horizons (30-day, 60-day forecasts)

---

## Key Takeaways for Business Users

‚úÖ **Switch Probability is a predictive early warning score (15-85%)**

‚úÖ **Five behavioral signals are analyzed: pattern stability, regime changes, direction flips, position reversals, and extremes**

‚úÖ **High scores (65-85%) require urgent action - call client within 48 hours**

‚úÖ **The system provides specific "drivers" and "risk flags" to guide your conversations**

‚úÖ **Use this as a tool to enhance your relationship management, not replace your judgment**

‚úÖ **The score helps you prioritize your time - focus on high-risk clients first**

---

## Glossary

| Term | Definition |
|------|------------|
| **Position Flip** | When a client goes from long to short (or vice versa) in the same instrument |
| **Holding Period** | How long a client keeps a position open before closing it |
| **Turnover** | How frequently a client trades (trades per day) |
| **Momentum Alignment** | Whether trades align with recent market direction |
| **Regime Change** | A significant shift in trading behavior patterns |
| **CUSUM** | Statistical method for detecting change points in data |
| **Volatility Spike** | Sudden increase in the variability of trading behavior |

---

## Getting Help

**For relationship managers:**
- Questions about a specific client's score? Contact your desk strategist
- Technical issues? Submit a ticket to the Trading Intelligence support team

**For analysts:**
- Want to understand the statistical methods? See the Technical Documentation
- Need to modify thresholds or weights? Contact the Quantitative Strategy team

---

*This system is designed to help you be proactive, not reactive. Use it to have better conversations with clients before they're thinking about leaving or changing strategies.*

---

## Appendix: How the System Calculates Switch Probability

*This section explains what data the system uses and how it processes it. You don't need to understand this to use the tool, but it's here if you're curious about what happens "under the hood."*

---

### What Data Does the System Use?

The system analyzes **90 days of historical data** for each client:

#### 1. **Trade Data**
Every trade the client executed, including:
- **When:** Date and time of each trade
- **What:** Which currency pair or instrument (e.g., EURUSD, GBPUSD)
- **Direction:** Buy or Sell
- **Size:** How many lots/contracts
- **Price:** Execution price

**Example data:**
```
2025-10-01 09:30  |  EURUSD  |  BUY   |  100,000  |  1.0850
2025-10-01 14:15  |  GBPUSD  |  SELL  |  50,000   |  1.2640
```

#### 2. **Position Data**
Current and historical positions:
- **Instrument:** What they're holding
- **Net Position:** Are they long (+) or short (-)
- **Gross Position:** Total capital at risk

**Example data:**
```
EURUSD:  +100,000 (long)
GBPUSD:  -50,000 (short)
USDJPY:  +25,000 (long)
```

#### 3. **Optional: Pre-computed Features**
Sometimes the system also looks at pre-calculated metrics:
- **Momentum Beta:** How closely trades follow market direction (-1 to +1)
- **Average Holding Period:** Typical time between opening and closing
- **Aggressiveness:** Percentage of urgent "market orders" vs patient "limit orders"

---

### How the Calculation Works

The system uses a **5-step scoring process**, then adds everything together:

```
Final Score = Starting Point (30%) + Signal 1 + Signal 2 + Signal 3 + Signal 4 + Signal 5
```

Then it "clamps" the result to stay between 15% and 85%.

---

### Signal 1: Pattern Instability Score (Worth up to 30%)

**What it measures:** How much the client's daily trading volume and instrument diversity varies

**The process:**

1. **Group all trades by day**
   - Count total volume traded each day
   - Count how many different instruments traded each day

2. **Calculate 14-day rolling variance**
   - Look at the last 14 days
   - Measure how much the volume bounces around
   - Measure how much the instrument count bounces around

3. **Compare recent variance to historical average**
   - Recent variance (last 7 days) vs 90-day average
   - If recent variance is much higher ‚Üí instability detected

4. **Calculate the score**
   ```
   Variance Ratio = Recent Variance √∑ Historical Variance
   Score = Average of volume and instrument ratios √ó 10%
   Maximum score capped at 30%
   ```

**Example:**
- Historical: Client trades 80-120 lots per day consistently
- Recent: Client trades 200 lots one day, 30 lots the next, 180 lots the next
- Variance ratio = 2.5√ó higher than normal
- Score = **22%** (high instability)

---

### Signal 2: Regime Change Detection (Worth up to 25%)

**What it measures:** Sudden shifts in trading behavior patterns

**The process:**

1. **Create daily metrics**
   - How many trades per day
   - How many instruments per day
   - What percentage were buy orders

2. **Run CUSUM analysis (Cumulative Sum statistical test)**
   - Calculate the average for each metric over 90 days
   - Track when actual behavior drifts from the average
   - Identify "peaks" where drift is significant

3. **Count recent change-points**
   - How many peaks occurred in the last 14 days
   - More recent peaks get higher weight

4. **Assign score based on findings**
   ```
   3+ change-points in last 14 days ‚Üí 25%
   2 change-points ‚Üí 18%
   1 change-point ‚Üí 12%
   No change-points ‚Üí 5%
   ```

**Example:**
- Day 1-60: Client trades 3-4 times per day, 70% buys
- Day 61: Suddenly trades 12 times per day, 90% buys
- Day 62-75: Continues new pattern
- CUSUM detects a "regime break" at Day 61
- Score = **18%** (recent regime change detected)

---

### Signal 3: Directional Flip-Flopping (Worth up to 20%)

**What it measures:** How often the client changes market direction opinion

**The process:**

1. **Calculate daily net direction**
   ```
   For each day:
   - Sum all BUY volumes
   - Sum all SELL volumes
   - If BUY > SELL: Direction = Long (+1)
   - If SELL > BUY: Direction = Short (-1)
   ```

2. **Count direction changes**
   - Compare each day to the previous day
   - Count how many times direction flipped

3. **Calculate flip rate**
   ```
   Recent rate = Flips in last 14 days √∑ 14
   Historical rate = Flips in all 90 days √∑ 90
   ```

4. **Assign score based on flip frequency**
   ```
   >60% of recent days flipped ‚Üí 20%
   40-60% of days flipped ‚Üí 15%
   20-40% of days flipped ‚Üí 10%
   <20% of days flipped ‚Üí 5%
   ```

**Example:**
- Last 14 days: Direction changed 9 times (64% flip rate)
- Historical 90 days: Direction changed 18 times (20% flip rate)
- Recent flip rate is 3√ó higher than historical
- Score = **20%** (frequent direction changes)

---

### Signal 4: Position Reversal Acceleration (Worth up to 15%)

**What it measures:** Whether position flips (long‚Üíshort or short‚Üílong) are increasing

**The process:**

1. **Track cumulative position for each instrument**
   ```
   For EURUSD:
   - Start: 0
   - BUY 100,000: Position = +100,000 (Long)
   - SELL 150,000: Position = -50,000 (Short) ‚Üê FLIP!
   - BUY 75,000: Position = +25,000 (Long) ‚Üê FLIP!
   ```

2. **Count flips per day for all instruments**

3. **Compare recent flip rate to historical rate**
   ```
   Recent rate = Average flips per day (last 7 days)
   Historical rate = Average flips per day (prior days)
   Acceleration = Recent √∑ Historical
   ```

4. **Assign score based on acceleration**
   ```
   Acceleration >1.5√ó (50% increase) ‚Üí 15%
   Acceleration >1.2√ó (20% increase) ‚Üí 10%
   Acceleration >1.0√ó (any increase) ‚Üí 5%
   Acceleration ‚â§1.0√ó (stable/decreasing) ‚Üí 2%
   ```

**Example:**
- Historical: 3 flips per month on average
- Recent: 8 flips in the last 7 days (34 per month pace)
- Acceleration = 11√ó increase
- Score = **15%** (rapidly accelerating flips)

---

### Signal 5: Extreme Behavior Detection (Worth up to 10%)

**What it measures:** Unusual extremes in trading characteristics

**The process:**

1. **Check momentum-beta extremes**
   ```
   If momentum-beta < 0.2 or > 0.9 ‚Üí Add 3%
   (Either ignoring market or following it blindly)
   ```

2. **Check holding period extremes**
   ```
   If average holding < 2 days or > 60 days ‚Üí Add 3%
   (Either day-trading or holding too long)
   ```

3. **Check aggressiveness extremes**
   ```
   If market order ratio < 20% or > 90% ‚Üí Add 4%
   (Either too patient or too rushed)
   ```

4. **Sum all extreme signals**
   ```
   Total drift score = Sum of all signals
   Maximum capped at 10%
   ```

**Example:**
- Momentum-beta = 0.95 (following market blindly) ‚Üí +3%
- Holding period = 1.5 days (very short for this client) ‚Üí +3%
- Aggressiveness = 35% (normal) ‚Üí 0%
- Total Score = **6%** (some extremes detected)

---

### Putting It All Together

**Example Calculation: High-Risk Client**

```
Starting baseline: 30%

Signal 1 (Pattern Instability): +22%
  ‚Üí High variance in daily volume and instruments

Signal 2 (Regime Change): +18%
  ‚Üí 2 major change-points detected in last 14 days

Signal 3 (Direction Flips): +15%
  ‚Üí 50% of recent days had directional changes

Signal 4 (Position Reversals): +15%
  ‚Üí Flip rate accelerated 5√ó vs historical

Signal 5 (Extreme Behavior): +6%
  ‚Üí Very short holding periods detected

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Raw total: 106%

After clamping to max 85%: 85% ‚Üê HIGH RISK
```

**What this tells the RM:**
This client is showing multiple strong signals of strategy instability. All five warning signs are present, with particularly concerning acceleration in position reversals and a recent regime break. **Urgent action recommended.**

---

### Data Sources in the System

The system pulls data from multiple sources:

| Data Type | Source System | How Often Updated |
|-----------|---------------|-------------------|
| **Trades** | Oracle OMS (Order Management System) | Real-time |
| **Positions** | Sybase Risk Warehouse | Every 15 minutes |
| **Market Prices** | Bloomberg API | Real-time |
| **News Headlines** | Reuters/Dow Jones | Real-time |
| **Client Metadata** | Salesforce CRM | Daily sync |

**In Demo Mode:** All data comes from CSV files to simulate production systems.

---

### How Long Does the Calculation Take?

The calculation speed depends on how much trading data exists:

| Client Activity Level | Number of Trades | Calculation Time |
|----------------------|------------------|------------------|
| **Light trader** | <100 trades in 90 days | <100 milliseconds |
| **Moderate trader** | 100-1,000 trades | 100-500 milliseconds |
| **Active trader** | 1,000-10,000 trades | 500ms-2 seconds |
| **High-frequency trader** | >10,000 trades | 2-5 seconds |

Most clients fall in the "moderate" category, so the calculation typically completes in **under half a second**.

---

### Why These Specific Thresholds?

You might wonder why the system uses specific numbers like "14 days" or "30% maximum score." These thresholds were chosen based on:

1. **Industry Research**
   - Academic literature on trading behavior
   - Market microstructure studies
   - Behavioral finance research

2. **Empirical Testing**
   - Analysis of historical client strategy switches
   - Backtesting on 3+ years of trading data
   - Validation with risk management teams

3. **Practical Experience**
   - Feedback from relationship managers
   - Calibration based on false positive rates
   - Adjustment for different market conditions

**These thresholds are not set in stone** - the system can be recalibrated as we gather more data on actual outcomes.

---

### Quality Checks and Error Handling

The system includes multiple safeguards:

**Data Quality Checks:**
- Ignores trades with negative quantities
- Validates timestamps are in proper format
- Removes obvious data errors (e.g., trade prices of $0)

**Calculation Safeguards:**
- Each signal calculation is wrapped in error handling
- If one signal fails, others continue normally
- Failed signals default to safe baseline values (5%)

**Edge Cases:**
- **<7 days of trades:** Returns baseline 30% (insufficient data)
- **Single instrument only:** Skips instrument diversity analysis
- **No position flips:** Returns minimum score for that signal

**Result Validation:**
- Final score always between 15% and 85%
- All component scores within expected ranges
- Reasoning text generated to explain the score

---

### Understanding the Limitations

**What the system CAN'T do:**

‚ùå **Predict external events**
- Can't anticipate major life changes (retirement, career moves)
- Can't predict market crashes or regulatory changes
- Can't account for factors not in trading data

‚ùå **Read minds**
- Can't know if changes are deliberate experimentation or confusion
- Can't distinguish between testing a new strategy vs struggling
- Can't factor in conversations you've had with the client

‚ùå **Be 100% accurate**
- Some clients will have high scores but remain stable
- Some clients with low scores may still switch strategies
- The score is a **probability**, not a certainty

**What the system DOES well:**

‚úÖ **Spots patterns humans might miss**
- Processes 90 days of data in milliseconds
- Tracks multiple metrics simultaneously
- Identifies subtle trend changes

‚úÖ **Provides consistent measurement**
- Same criteria applied to all clients
- Removes human bias from detection
- Enables apples-to-apples comparison

‚úÖ **Flags issues early**
- Often detects changes before they're obvious
- Gives you time to intervene proactively
- Helps prioritize your limited time

---

### Future Enhancements Planned

The system is designed to learn and improve:

**Phase 2 (Next 6 months):**
- Machine learning models trained on actual switch outcomes
- Segment-specific thresholds (hedgers vs trend followers behave differently)
- Market condition adjustments (higher volatility = higher noise tolerance)

**Phase 3 (Next 12 months):**
- Longer prediction horizons (30-day, 60-day forecasts)
- Integration with sentiment analysis from client communications
- "Similar client" comparisons for context
- Personalized baseline calibration per client

**Feedback Loop:**
- System tracks which predictions were accurate
- Learns from false positives (high score but no switch)
- Learns from false negatives (low score but client did switch)
- Continuously refines thresholds and weights

---

## Technical Reference

For developers and quantitative analysts who need the mathematical details, see the complete **Technical Documentation** which includes:

- Statistical formulas for each signal
- CUSUM algorithm implementation
- Pseudocode and Python examples
- Performance optimization notes
- API integration specifications
- Database schema details

---

*This appendix provides transparency into how the system works without requiring you to understand the mathematics. Think of it like knowing how a car engine works vs being able to drive - you can be an effective user of the tool without knowing every technical detail.*
